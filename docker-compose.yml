version: '3.8'

networks:
  raidan_net:
    driver: bridge

services:
  # Gateway - Main API Entrance
  gateway:
    build: ./gateway
    container_name: YJPT_Gateway
    ports:
      - "8000:8000"
    env_file: .env
    networks:
      - raidan_net
    restart: always

  # NLP Engine - MARBERT Sentiment Analysis
  nlp-engine:
    build: ./nlp-engine
    container_name: YJPT_NLP
    ports:
      - "8001:8001"
    env_file: .env
    networks:
      - raidan_net
    restart: always

  # Legal Meter - Qdrant Vector Analysis
  legal-meter:
    build: ./legal-meter
    container_name: YJPT_LegalMeter
    ports:
      - "8002:8002"
    env_file: .env
    networks:
      - raidan_net
    depends_on:
      - qdrant
    restart: always

  # Voice Legacy - TTS / Virtual Anchor
  voice-legacy:
    build: ./voice-legacy
    container_name: YJPT_Voice
    ports:
      - "8003:8003"
    env_file: .env
    volumes:
      - shared-uploads:/app/shared-uploads
    networks:
      - raidan_net
    restart: always

  # Forensics - Image Analysis
  forensics:
    build: ./forensics-service
    container_name: YJPT_Forensics
    ports:
      - "8080:8080"
    networks:
      - raidan_net
    restart: always

  # Database - PostgreSQL
  db:
    image: postgres:16-alpine
    container_name: YJPT_Database
    environment:
      POSTGRES_USER: raidan_admin
      POSTGRES_PASSWORD: Samah@2052024X
      POSTGRES_DB: raidan_vault
    volumes:
      - ./db_data:/var/lib/postgresql/data
    networks:
      - raidan_net

  # Vector Database - Qdrant
  qdrant:
    image: qdrant/qdrant:latest
    container_name: YJPT_Qdrant
    ports:
      - "6333:6333"
    volumes:
      - ./qdrant_data:/qdrant/storage
    networks:
      - raidan_net

  # Automation - n8n
  n8n:
    image: n8nio/n8n:latest
    container_name: YJPT_Automation
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=true
      - N8N_BASIC_AUTH_USER=raidan_admin
      - N8N_BASIC_AUTH_PASSWORD=Samah@2052024X
    volumes:
      - ./n8n-data:/home/node/.n8n
    networks:
      - raidan_net

  # Storage - MinIO
  minio:
    image: minio/minio:latest
    container_name: YJPT_MinIO
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      - MINIO_ROOT_USER=raidan_admin
      - MINIO_ROOT_PASSWORD=Samah@2052024X
    command: server /data --console-address ":9001"
    networks:
      - raidan_net

volumes:
  shared-uploads:
